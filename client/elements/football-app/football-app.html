<!--
Copyright (c) 2014 Alan Chandler. All rights reserved
This file is part of MBBall, an American Football Results Picking
Competition Management software suite.

MBBall is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

MBBall is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with MBBall (file LICENCE).  If not, see <http://www.gnu.org/licenses/>.

-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../smf-auth/smf-auth.html">
<polymer-element name="football-app" attributes="forum auth server-base ">
  <template>
    <smf-auth id="football-auth" url="{{auth}}" guest="false" token="{{token}}" ></smf-auth>

    <core-ajax id="participant-req"
            url="{{server-base}}/participants/{{user.uid}}"
            handlerAs="json"
            headers="x-access-token:{{token}}"
            on-core-response="{{participantResponse}}"
    <core-animated-pages selected="0">
        <section id="page1">
            <h1>MBBall</h1>
            <p>An American Football results picking competition</p>
            <img src="mblogo.png"/>
            <paper-dialog heading="Only Forum Members" backdrop="true" layered="true" autoCloseDisabled="true" transition="paper-transition-center">
                <p>MBBall is an American Football Results picking competition which is just one of the exciting facilities available to members of our community.
                    To use it you have to be logged on to the forum, and at the moment you are not.</p>
                <p>If you are already a member then Login first, otherwise Register.</p>
                <paper-button label="Register" dismissive onclick="{{Register}}"></paper-button>
                <paper-button label="Login" affirmative autoFocus onclick="{{Login}}"></paper-button>
            </paper-dialog>
        </section>
        <section id="page3">
            <p>Unfortunately there is no competition to register to right now</p>
        </section>
        <football-register user="{{user}}" token="{{token}}"></football-register>
        <football-manager user="{{user}}" token="{{token}}"></football-manager>
    </core-animated-pages>
    </template>

  </template>

  <script>
  Polymer('football-app',{
    created:function(){
      this.user = {};
      this.token = '';
    },
    ready:function() {
      this.$.football-auth.addEventListener('auth-done', function(e){

      });
    }
    attached:function(){
      this.$.participant-req.go();
    },
    participantResponse:function(response){
      //TODO decide what the response is
    },
      Register: function(){
          window.location = this.forum + '?action=register';
      },
      Login:function() {
          window.location = this.forum + '?action=login';
      }
  });
  </script>
</polymer-element>
